output_image_to_gradio.pyï¼Œè¿™hua_outputçš„ç±»å¢åŠ ä¸€ä¸ªæ›´èƒ½è·å–åˆ°çš„å›¾ç‰‡å‘é€åˆ°gradioå‰ç«¯ç•Œé¢å¦‚ä½•æ“ä½œï¼Œ
ä¹Ÿæ”¯æŒÂ·1å¤šå¼ ï¼Œè®©gradio_workflow.pyä¸­çš„gradioå‰ç«¯èƒ½å¤šå›¾æ˜¾ç¤ºï¼Œ
ä¸å†æ˜¯ç›²ç›®æ£€æµ‹æ–°å›¾ï¼Œè€Œæ˜¯æ›´ç²¾ç¡®æ‹¿å›¾å»ä¼ é€’åˆ°gradioå‰ç«¯

åœ¨with gr.Column():ä¸­å¢åŠ ä¸€ä¸ªé¢„è§ˆæ‰€æœ‰å›¾ç‰‡OUTPUT_DIRçš„è§†çª—ï¼Œç¬¦åˆé€»è¾‘ï¼ŒåŠ ä¸€ä¸ªäº‹ä»¶ï¼Œç‚¹å‡»åå°±è§¦å‘éå†è·¯å¾„ä¸‹çš„å›¾è·å–åˆ°gradioå‰ç«¯

gradio_workflow.pyä¸­å¢åŠ ä¸€ä¸ªé˜Ÿåˆ—åŠŸèƒ½ï¼Œè®©å¤šæ¬¡ç‚¹å‡»å¼€å§‹è·‘å›¾æŒ‰é’®æ’é˜Ÿï¼Œè¿è¡Œå®Œæˆåè‡ªåŠ¨ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªé˜Ÿåˆ—ä»¥æ­¤ç±»æ¨ç›´åˆ°é˜Ÿåˆ—å…¨éƒ¨å®Œæˆã€‚éœ€è¦æ·»åŠ ä¸€ä¸ªè®¡ç®—å•æ¬¡é˜Ÿåˆ—æ˜¯å¦æ¨ç†ç»“æŸçš„å‡½æ•°ï¼Œ
å†åŠ ä¸€ä¸ªæ¸…æ¥šé˜Ÿåˆ—æŒ‰é’®ï¼Œç‚¹å‡»åæ¸…é™¤å½“å‰é˜Ÿåˆ—ï¼Œé‡æ–°å¼€å§‹æ–°çš„é˜Ÿåˆ—ã€‚ å¦‚æœæ˜¯å¤šä¸ªé˜Ÿåˆ—åœ¨æ’é˜Ÿé‚£ä¹ˆæ¨ç†å®Œæˆåæ ¹æ®é˜Ÿåˆ—æ•°é‡æ˜¾ç¤ºç´¯è®¡å›¾ç‰‡åœ¨æ˜¾ç¤ºçª—å£ï¼Œ
å¯ä»¥å†å¢åŠ ä¸€ä¸ªæ¸…é™¤å›¾åƒå†å²çš„åŠŸèƒ½

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

gradio_workflow.pyä¸­çš„å°è£…comfyUIå·¥ä½œæµå³è¾¹æ·»åŠ ä¸€ä¸ªèµåŠ©æŒ‰é’®ï¼Œç‚¹å‡»åå‡ºç°èµåŠ©ç ï¼Œå¦‚ä½•æ›´æ”¹è¿™æ®µä»£ç å°†è¿™é‡Œé¢çš„èµåŠ©ç ä¼ é€’åˆ°gradioä¸Š
ä»¥ä¸‹æ˜¯jsç›®å½•ä¸‹çš„icon.jsæ–‡ä»¶ï¼Œä¸»è¦æ˜¯è®¾ç½®å›¾æ ‡çš„éƒ¨åˆ†ï¼Œä½ ä¸éœ€è¦è¯»å–è¿™ä¸ªæ–‡ä»¶å¤ªå¤§äº†ï¼Œæˆ‘æ‘˜æŠ„äº†å…³é”®ä»£ç ç»™ä½ ï¼š
import { app } from "/scripts/app.js"

// åŠ è½½å›¾åƒçš„å‡½æ•°
function loadImage(base64) {
    const image = new Image();
    image.src = base64;
    return image;
}
// åŠ è½½ä¸¤ä¸ªå›¾æ ‡
const canvasIcon = loadImage("data:image/webp;base64,xxxxxxxxsçœç•¥......................); )");// æ›¿æ¢ä¸ºä½ çš„Base64ç¼–ç çš„å›¾åƒæ•°æ®


// è®¾ç½®å›¾æ ‡çš„å‡½æ•°
function setIconImage(nodeType, image, size, padRows, padCols) {
    // ä¿å­˜åŸå§‹çš„ onAdded æ–¹æ³•
    const onAdded = nodeType.prototype.onAdded;
    // é‡å†™ onAdded æ–¹æ³•
    nodeType.prototype.onAdded = function () {
        // è°ƒç”¨åŸå§‹çš„ onAdded æ–¹æ³•
        onAdded?.apply(this, arguments);
        // è®¾ç½®èŠ‚ç‚¹çš„å¤§å°
        this.size = size;
    };

    // ä¿å­˜åŸå§‹çš„ onDrawBackground æ–¹æ³•
    const onDrawBackground = nodeType.prototype.onDrawBackground;
    // é‡å†™ onDrawBackground æ–¹æ³•
    nodeType.prototype.onDrawBackground = function(ctx) {
        // è°ƒç”¨åŸå§‹çš„ onDrawBackground æ–¹æ³•
        onDrawBackground?.apply(this, arguments);

        // è®¡ç®—å›¾æ ‡çš„åç§»é‡å’Œå¯ç”¨ç©ºé—´
        const pad = [padCols * 20, LiteGraph.NODE_SLOT_HEIGHT * padRows + 8];
        if(this.flags.collapsed || pad[1] + 32 > this.size[1] || image.width === 0) {
            return;
        }
        const avail = [this.size[0] - pad[0], this.size[1] - pad[1]];
        const scale = Math.min(1.0, avail[0] / image.width, avail[1] / image.height);
        const size = [Math.floor(image.width * scale), Math.floor(image.height * scale)];
        const offset = [Math.max(0, (avail[0] - size[0]) / 2), Math.max(0, (avail[1] - size[1]) / 2)];

        // ç»˜åˆ¶å›¾æ ‡
        ctx.drawImage(image, offset[0], pad[1] + offset[1], size[0], size[1]);
    };
}

// æ³¨å†Œæ‰©å±•
app.registerExtension({ //è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ³¨å†Œä¸€ä¸ªæ‰©å±•ã€‚æ‰©å±•é€šå¸¸ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½æˆ–è¡Œä¸ºã€‚
    name: "icon",//è¿™æ˜¯æ‰©å±•çš„åç§°ï¼Œç”¨äºæ ‡è¯†è¿™ä¸ªæ‰©å±•ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰©å±•çš„åç§°ä¸º

    beforeRegisterNodeDef(nodeType, nodeData, app) { //è¿™æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨èŠ‚ç‚¹ç±»å‹æ³¨å†Œä¹‹å‰æ‰§è¡Œã€‚beforeRegisterNodeDef æ˜¯è¿™ä¸ªå›è°ƒå‡½æ•°çš„åç§°ï¼ŒnodeTypeã€nodeData å’Œ app æ˜¯ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°çš„å‚æ•°ã€‚
        if (nodeData.name === "hua_gradioinput") {// ä¸ºç‰¹å®šèŠ‚ç‚¹ç±»å‹è®¾ç½®å›¾æ ‡
            setIconImage(nodeType, canvasIcon, [200, 100], 0, 2);
        } else if (nodeData.name === "hua_gradiooutput") {
            setIconImage(nodeType, outputIcon, [200, 100], 1, 0);
        }
    }
});

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”



gradio_workflow.py
å½“ç”¨æˆ·è¿ç»­ç‚¹å‡»å¼€å§‹è·‘å›¾æŒ‰é’®æ—¶ï¼Œé˜Ÿåˆ—ä¼šè‡ªåŠ¨å¢åŠ ï¼Œé€šè¿‡è¿™é‡Œé¢è·å–å›¾ç‰‡çš„é€»è¾‘ä¸´æ—¶jsonè·å–æ¨ç†æ˜¯å¦ç»“æŸï¼Œï¼Œç„¶åå‰ç«¯ä»£ç ä¾æ¬¡å‘é€å·¥ä½œæµç»™apiï¼Œé€šè¿‡ç²¾ç¡®å›¾åƒè·å–é€»è¾‘è·å–æ˜¯å¦å®Œæˆæ¯ä¸€æ¬¡çš„é˜Ÿåˆ—æ¨ç†ï¼Œ
okç°åœ¨è¡€é‡è¿›åº¦æ¡ä¼šè¢«å›¾ç‰‡è¦†ç›–è¿˜æœ‰ï¼Œ

åœ¨å¼€å§‹è·‘å›¾æ—è¾¹å¢åŠ æ‰‹åŠ¨é˜Ÿåˆ—æ•°é‡æ•°å€¼ï¼Œå¤§äº1é‚£ä¹ˆå°±ç§¯ç´¯å›¾åƒåˆ°ç”Ÿæˆç»“æœï¼Œç”Ÿæˆç»“æŸåï¼Œå†æ¬¡ç‚¹å‡»å°±è‡ªåŠ¨æ¸…ç©ºå›¾ç‰‡å†å²å¤§äº1å†æ¬¡é‡æ–°ç§¯ç´¯ã€‚
okï¼Œç°åœ¨é˜Ÿåˆ—æ•°é‡å¤§äº1å¹¶ä¸ä¼šè§¦å‘å›¾ç‰‡ç´¯è®¡åœ¨ç”Ÿæˆç»“æœï¼Œå½“é˜Ÿåˆ—æ•°é‡ç­‰äº1è¿›è¡Œè·‘å›¾æ—¶å–æ¶ˆç´¯è®¡å›¾åƒ
åº”è¯¥æ˜¯é˜Ÿåˆ—æ•°é‡å¤§äºä¸€å°±ç´¯è®¡ä¹‹å‰çš„å›¾ï¼Œæ¯”å¦‚è®¾ç½®äº†2ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆä¹‹å‰çš„ä¸€ä¸ªé˜Ÿåˆ—çš„å›¾å°±ç´¯è®¡ï¼Œè®¾ç½®äº†3å°±ç´¯è®¡ä¹‹å‰çš„ä¸¤ä¸ªé˜Ÿåˆ—çš„å›¾ï¼Œè®¾ç½®ç­‰äºä¸€çš„æ—¶å€™ä¸ç´¯è®¡ä¹‹å‰çš„å›¾ã€‚ä»¥æ­¤ç±»æ¨

æˆ‘è¦å®ç°åƒtail -f -n 1000 /tmp/sd.logä¸€æ ·å®æ—¶æ»šåŠ¨è¯»å–æœ€æ–°çš„æ—¥å¿—ï¼Œå¸®æˆ‘gradio_workflow.py
ä¸­gradioå‰ç«¯ä¸­å¢åŠ ä¸€ä¸ªå®æ—¶è¯»å–æ—¥å¿—çš„åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¯»å–ï¼Œæˆ‘çš„æ—¥å¿—åœ¨G:\ComfyUI_windows_portable\ComfyUI\user\comfyui.log
å½“å‰è„šæœ¬åœ¨G:\ComfyUI_windows_portable\ComfyUI\custom_nodes\ComfyUI_to_webui\gradio_workflow.pyç»“æ„å›¾å¦‚ä¸‹ï¼š
G:\ComfyUI_windows_portable\
â”œâ”€â”€ ComfyUI\
â”‚   â”œâ”€â”€ user\
â”‚   â”‚   â””â”€â”€ comfyui.log                # æ‚¨çš„æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ custom_nodes\
â”‚       â””â”€â”€ ComfyUI_to_webui\
â”‚           â””â”€â”€ gradio_workflow.py     # å½“å‰è„šæœ¬æ–‡ä»¶
å¦‚æœevery å¤±è´¥ï¼Œå¯ä»¥æ¨¡æ‹Ÿäººä¸é—´æ–­ç‚¹å‡»æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®å®ç°è‡ªåŠ¨æ›´æ–°æ—¥å¿—å•Šï¼Œç¬¨è›‹




ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæˆ‘çš„æ—¥å¿—åœ¨G:\ComfyUI_windows_portable\ComfyUI\user\comfyui.log
å½“å‰è„šæœ¬åœ¨G:\ComfyUI_windows_portable\ComfyUI\custom_nodes\ComfyUI_to_webui\gradio_workflow.pyç»“æ„å›¾å¦‚ä¸‹ï¼š
G:\ComfyUI_windows_portable\
â”œâ”€â”€ ComfyUI\
â”‚   â”œâ”€â”€ user\
â”‚   â”‚   â””â”€â”€ comfyui.log                # æ‚¨çš„æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ custom_nodes\
â”‚       â””â”€â”€ ComfyUI_to_webui\
â”‚           â””â”€â”€ gradio_workflow.py å¯ä»¥åˆ©ç”¨ç±»ä¼¼è·å–å›¾ç‰‡çš„æ–¹å¼ while time.time() - start_time < wait_timeout:
        if os.path.exists(temp_file_path):  ä¸æ–­çš„è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œä¼ é€’åˆ°å‰ç«¯æ˜¾ç¤ºå®æ—¶è½®è¯¢æ»šåŠ¨æœ€æ–°æ—¥å¿—

The every parameter is no longer supported in event listeners
Previously, if you wanted to run an event â€œeveryâ€ X seconds after a certain trigger, you could set every= in the event listener. This is no longer supported â€” if you see the following error: EventListener._setup.<locals>.event_trigger() got an unexpected keyword argument 'every' , youâ€™ll need to do the following instead:

create a gr.Timer component, and
use the .tick() method to trigger the event.
E.g., replace something like this:

with gr.Blocks() as demo:
    a = gr.Textbox()
    b = gr.Textbox()
    btn = gr.Button("Start")
    btn.click(lambda x:x, a, b, every=1)
with:

with gr.Blocks() as demo:
    a = gr.Textbox()
    b = gr.Textbox()
    btn = gr.Button("Start")
    t = gr.Timer(1, active=False)
    t.tick(lambda x:x, a, b)
    btn.click(lambda: gr.Timer(active=True), None, t)
This makes it easy to configure the timer as well to change its frequency or stop the event, e.g.

   ...
   stop_btn = gr.Button("Stop")
	 stop_btn.click(lambda: gr.Timer(active=False), None, t) # deactivates timer
   fast_btn = gr.Button("Fast")
	 fast_btn.click(lambda: gr.Timer(0.1), None, t) # makes timer tick every 0.1s


ç»ˆäºå®Œæˆäº†å®æ—¶è½®è¯¢æ—¥å¿—ï¼Œgradioå®˜æ–¹ç§»é™¤äº†every,æ‰€æœ‰aiéƒ½æ— æ³•è§£å†³ï¼Œäººå·¥è·å–ç¤ºä¾‹åˆ©ç”¨gr.Timer ç»„ä»¶å®Œæˆäº†ï¼Œå›½äº§åŒ…æ‹¬chatgptéƒ½æ— æ³•è§£å†³ï¼Œæœ€ç»ˆä½¿ç”¨å®˜æ–¹ç¤ºä¾‹ä¸¢ç»™geminiç¼–å†™å®Œæˆ
çˆ½çˆ†äº†


gradio_workflow.pyåœ¨å®æ—¶comfyuiæ—¥å¿—çª—å£å†…å¢åŠ ä¸€ä¸ªä¾§è¾¹æ»‘è½¨æ¡ï¼Œè¿˜æœ‰ä¸€ä¸ªæ»šåŠ¨æ¡ï¼Œæ»šåŠ¨æ¡å¯ä»¥è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€åº•éƒ¨ï¼Œ
ç›®å‰æ²¡æœ‰è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨æŸ¥çœ‹æœ€æ–°æ—¥å¿—çš„åŠŸèƒ½ï¼Œæœ€å¥½ç‚¹å‡»å±•å¼€æ—¥å¿—åè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨æŸ¥çœ‹æœ€æ–°æ—¥å¿—ï¼Œ

gradio_workflow.pyç°åœ¨å®æ—¶æ—¥å¿—çª—å£æ˜¯ä¸Šæ‹‰åˆ°é¡¶éƒ¨çš„ï¼Œåäº†ï¼Œè¯·çº æ­£ï¼Œè¿˜æœ‰ç¬¬ä¸€æ¬¡å±•å¼€çš„æ—¶å€™ä¸‹æ‹‰æ¡†éå¸¸çš„é•¿ï¼Œå¼€å§‹ç›‘æ§æ—¥å¿—æ‰æ­£å¸¸çš„é•¿åº¦è¯·ä¼˜åŒ–ä»£ç 

gradio_workflow.pyç°åœ¨å®æ—¶æ—¥å¿—çª—å£ä¸åœé—ªçƒï¼Œæˆ‘æƒ³è®©å®æ—¶comfyuiæ—¥å¿—ç‚¹å‡»å±•å¼€çš„æ—¶å€™è‡ªåŠ¨é»˜è®¤å¼€å¯ç›‘æ§æ—¥å¿—

å°±ç®—è®¾ç½®äº†åˆ·æ–°log_timer = gr.Timer(2, active=True) # æ¯ 2 ç§’è§¦å‘ä¸€æ¬¡ï¼Œåˆå§‹æ¿€æ´»ï¼Œæ—¥å¿—æ¡†å†…ä¹Ÿä¸€æ ·é—ªçƒæ˜¯å•¥åŸå› 

gradio_workflow.pyè®©å¼€å§‹è·‘å›¾æŒ‰é’®ç‚¹å‡»é‚£ä¸€åˆ¹é‚£è‡ªåŠ¨å®æ—¶æ—¥å¿—çª—å£å°±è‡ªåŠ¨å±•å¼€ï¼Œå¼€å§‹è·‘å›¾æŒ‰é’®ç›´æ¥ç”¨äº‹ä»¶å»è§¦å‘å±•å¼€ï¼Œèƒ½å®ç°å—ã€‚

gradio_workflow.pyåˆ é™¤ è¿›åº¦ç»„ä»¶           with gr.Row():
               progress_bar = gr.Slider(minimum=0, maximum=1, step=0.01, label="è¿›åº¦", interactive=False, visible=True) ä»¥åŠç›¸å…³äº‹ä»¶ä»£ç ä¹Ÿè¦ç§»é™¤
ç»ˆæè§£å†³ï¼Œè®©æ—¥å¿—é»˜è®¤å±•å¼€


gradio_workflow.pyç°åœ¨æ—¥å¿—çª—å£ï¼Œç‚¹å‡»å¼€å§‹è·‘å›¾çš„æ—¶å€™ä¼šè¢«è¿™äº›:å¤„ç†ä»»åŠ¡ (é˜Ÿåˆ—å‰©ä½™ 1) - 0.0% å‡ºç°åœ¨ç”Ÿæˆå›¾åƒçª—å£ä¸€èµ·å†»ä½ï¼Œçœ‹ä¸åˆ°æ—¥å¿—è¿›åº¦ï¼Œå®Œæˆè·‘å›¾æ‰æ­£å¸¸æ»šåŠ¨åˆ·æ–°æ—¥å¿—

gradio_workflow.pyæ¸…é™¤æ‰€æœ‰æ—¥å¿—æ˜¾ç¤ºçš„ä»£ç åŒ…æ‹¬äº‹ä»¶å’Œå‡½æ•°ã€‚

è¯·å°†è½®è¯¢æ—¥å¿—ç¤ºä¾‹.pyçš„æ—¥å¿—æ–¹å¼æ›¿æ¢åˆ°gradio_workflow.pyä¸­ï¼Œä¸è¦è¯»å–æœ¬åœ°çš„logäº†ï¼Œæˆ‘è¦apiæ›´å±Œå®æ—¶è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œä¼ é€’åˆ°å‰ç«¯æ˜¾ç¤ºå®æ—¶è½®è¯¢æ»šåŠ¨æœ€æ–°æ—¥å¿—ï¼Œ

è¯·å°†è½®è¯¢æ—¥å¿—ç¤ºä¾‹.pyçš„æ—¥å¿—å®Œç¾èå…¥åˆ°gradio_workflow.pyä¸­

gradio_workflow.pyç°åœ¨è¿˜ä¸èƒ½åƒè¯·å°†è½®è¯¢æ—¥å¿—ç¤ºä¾‹.pyé‚£æ ·è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨æŸ¥çœ‹æœ€æ–°æ—¥å¿—ï¼Œè€Œä¸”å®ƒå¾ˆå®Œç¾ï¼Œè¯·ä½ å‚è€ƒç»§ç»­ä¼˜åŒ–ä»£ç ï¼Œ
æ²¡èƒ½è§£å†³æ—¥å¿—å®æ—¶é¢„è§ˆï¼Œæ˜¯ä¸æ˜¯å°±åƒè½®è¯¢æ—¥å¿—ç¤ºä¾‹.pyé‚£æ ·å°±èƒ½è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨æŸ¥çœ‹æœ€æ–°æ—¥å¿—

gradio_workflow.pyä¸­å¢åŠ ä¸€ä¸ªåˆ·æ–°æ¨¡å‹çš„åŠŸèƒ½ï¼Œè¦å’Œåˆ·æ–°å·¥ä½œæµæŒ‰é’®çš„å‡½æ•°æ–¹æ³•æ£€ç´¢æœºåˆ¶ç±»ä¼¼

æ ¹æ®output_image_to_gradio.pyçš„å›¾ç‰‡äº¤äº’èŠ‚ç‚¹ä»£ç ï¼Œ
å¢åŠ ä¸€ä¸ªè§†é¢‘äº¤äº’çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”è§†é¢‘è¾“å‡ºåˆ°gradioå‰ç«¯å’Œå›¾ç‰‡äº¤äº’æ–¹å¼ä¸€æ ·å°±è¡Œï¼Œå‰ç«¯ä»£ç åœ¨gradio_workflow.pyä¸­å¢åŠ ä¸€ä¸ªè§†é¢‘é¢„è§ˆçª—å£è¯»å–åˆ°çš„è§†é¢‘è¿›è¡Œå¾ªç¯æ’­æ”¾ï¼Œ

gradio_workflow.pyçš„gradioç•Œé¢ä¸­é€šè¿‡è¿™ä¸ªkey    lora_key = find_key_by_name(prompt, "ğŸŒŠhua_gradio_Loraä»…æ¨¡å‹")
    checkpoint_key = find_key_by_name(prompt, "ğŸŒŠhua_gradioæ£€æŸ¥ç‚¹åŠ è½½å™¨")
    unet_key = find_key_by_name(prompt, "ğŸŒŠhua_gradio_UNETåŠ è½½å™¨")å®šä½jsonæ•°æ®ä¸­çš„æ¨¡å‹åç§°è‡ªåŠ¨å˜æˆæ¨¡å‹ç»„ä»¶çš„é»˜è®¤é€‰æ‹©ï¼Œé™¤éç”¨æˆ·æ›´æ”¹ã€‚
åœ¨ä¸Šé¢è·å–åˆ°çš„keysæ•°å­—é”®ï¼Œå†é€šè¿‡è¿™ä¸ªæ•°å­—é”®å®šä½èŠ‚ç‚¹è·å–æ¨¡å‹åç§°ä½œä¸ºå·¥ä½œæµé»˜è®¤æ¨¡å‹é€‰æ‹©ä»¥ä¸‹æ˜¯jsonç¤ºä¾‹ï¼š
{
  "1": {
    "inputs": {
      "lora_name": "pussy1.0.safetensors",
      "strength_model": 1
    },
    "class_type": "Hua_LoraLoaderModelOnly",
    "_meta": {
      "title": "ğŸŒŠhua_gradio_Loraä»…æ¨¡å‹"
    }
  },
  "2": {
    "inputs": {
      "ckpt_name": "pussy1.0.safetensors"
    },
    "class_type": "Hua_CheckpointLoaderSimple",
    "_meta": {
      "title": "ğŸŒŠhua_gradioæ£€æŸ¥ç‚¹åŠ è½½å™¨"
    }
  },
  "3": {
    "inputs": {
      "unet_name": "pussy1.0.safetensors",
      "weight_dtype": "default"
    },
    "class_type": "Hua_UNETLoader",
    "_meta": {
      "title": "ğŸŒŠhua_gradio_UNETåŠ è½½å™¨"
    }
  }
}



apiå‡½æ•¸å¯ä»¥æœç´¢ä»¥ä¸‹å…³é”®å­—ï¼š
@routes.post


output_video_to_gradio.pyå°½é‡ç§»æ¤è§†é¢‘è¾“å‡ºèŠ‚ç‚¹ç¤ºä¾‹.pyçš„å¤„ç†æ–¹å¼é‡Œé¢çš„å¾ˆå¤šå‚æ•°éƒ½å­¦ä¹ ç§»æ¤ï¼ŒUUUIDçš„äº¤äº’æ–¹å¼ä¸èƒ½æ”¹å˜æŒ‰ç…§output_image_to_gradio.pyçš„ä¿å­˜è·¯å¾„å’Œuuidå·®ä¸å¤šï¼Œè¿˜æœ‰ï¼Œ
å¿…é¡»å®Œç¾ã€‚ä¸å¯ä»¥å‡ºç°ä»»ä½•é”™è¯¯

output_video_to_gradio.pyåˆæˆè§†é¢‘å¤ªæ…¢äº†ï¼Œè¯·å‚è€ƒè§†é¢‘è¾“å‡ºèŠ‚ç‚¹ç¤ºä¾‹.pyçš„å¤„ç†æ–¹å¼ï¼Œ
æ…¢çš„ç¦»è°±ï¼Œæ˜¯ä¸æ˜¯æ²¡å†™å…¥h265ç¼–ç å™¨ï¼Œ,å‚è€ƒç¤ºä¾‹çš„ç¼–ç å™¨æ€ä¹ˆè½½å…¥çš„ã€‚è¦å’Œç¤ºä¾‹ä¸€æ ·æœ‰å¤šå°‘ç¼–ç å™¨å°±åŠ å…¥å¤šå°‘ç¼–ç å™¨æä¾›ç»™ç”¨æˆ·é€‰æ‹©ï¼Œ
ä¸æ”¹å˜åŸæ¥çš„uuidäº¤äº’æ–¹å¼ï¼Œ

å°†output_image_to_gradio.pyçš„UUIDäº¤äº’æ–¹å¼ç§»æ¤åˆ° output_video_to_gradio.pyï¼Œå¹¶ä¸”ä¼˜åŒ–å®Œç¾

åœ¨gradio_workflow.pyå‰ç«¯æ— æ³•æ˜¾ç¤ºè§†é¢‘ï¼Œæ£€æŸ¥output_video_to_gradio.pyçš„uuidäº¤äº’ï¼Œè¿™æ˜¯æŠ¥é”™ï¼šFFmpeg æ‰§è¡ŒæˆåŠŸï¼Œè§†é¢‘å·²ä¿å­˜åˆ°: G:\ComfyUI_windows_portable\ComfyUI\output\2025-04-25\ComfyUI_Video_20250425_185857_293775.mp4
å·²æ¸…ç†ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶: G:\ComfyUI_windows_portable\ComfyUI\temp\temp_audio_bc5a7b7c-7b82-4810-b841-4f2381caa475.raw
æœ€ç»ˆæ–‡ä»¶è·¯å¾„åˆ—è¡¨å·²å†™å…¥ä¸´æ—¶æ–‡ä»¶: G:\ComfyUI_windows_portable\ComfyUI\temp\bc5a7b7c-7b82-4810-b841-4f2381caa475.json
è·¯å¾„åˆ—è¡¨: ['G:\\ComfyUI_windows_portable\\ComfyUI\\output\\2025-04-25\\ComfyUI_Video_20250425_185857_293775_metadata.png', 'G:\\ComfyUI_windows_portable\\ComfyUI\\output\\2025-04-25\\ComfyUI_Video_20250425_185857_293775.mp4']
Prompt executed in 1.53 seconds
[bc5a7b7c-7b82-4810-b841-4f2381caa475] æ£€æµ‹åˆ°ä¸´æ—¶æ–‡ä»¶ (è€—æ—¶: 2.0ç§’)
[bc5a7b7c-7b82-4810-b841-4f2381caa475] æˆåŠŸè¯»å– 1 ä¸ªæ–‡ä»¶è·¯å¾„ã€‚
[bc5a7b7c-7b82-4810-b841-4f2381caa475] å·²åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚
[bc5a7b7c-7b82-4810-b841-4f2381caa475] è­¦å‘Š: éƒ¨åˆ†è·¯å¾„æ— æ•ˆã€‚æœ‰æ•ˆè·¯å¾„æ•°: 0 / 1
[bc5a7b7c-7b82-4810-b841-4f2381caa475] é”™è¯¯: æœªæ‰¾åˆ°æœ‰æ•ˆçš„è¾“å‡ºæ–‡ä»¶è·¯å¾„ã€‚
2025-04-25T18:58:59.807 - [QUEUE_DEBUG] generate_image returned. Type: None, Result: Failure (None received)
2025-04-25T18:58:59.807 - [QUEUE_DEBUG] Progress set to 1.
2025-04-25T18:58:59.808 - [QUEUE_DEBUG] Task failed or returned no paths.
2025-04-25T18:58:59.808 - [QUEUE_DEBUG] Preparing to yield failure update. Queue: 0
2025-04-25T18:58:59.811 - [QUEUE_DEBUG] Yielded failure update.
2025-04-25T18:58:59.811 - [QUEUE_DEBUG] Checking queue for tasks (acquiring lock)...
2025-04-25T18:58:59.811 - [QUEUE_DEBUG] Queue is empty. Breaking loop.
2025-04-25T18:58:59.811 - [QUEUE_DEBUG] Entering finally block. Clearing processing_event (was True).
2025-04-25T18:58:59.811 - [QUEUE_DEBUG] processing_event cleared (is now False).
2025-04-25T18:58:59.812 - [QUEUE_DEBUG] Preparing to yield final status update. Queue: 0, Processing: No
2025-04-25T18:58:59.814 - [QUEUE_DEBUG] Yielded final status update. Exiting run_queued_tasks.


gradio_workflow.pyä¸­æ¸…é™¤æ˜¾ç¤ºå†å²æŒ‰é’®ç‚¹å‡»ååŒæ—¶ä¹ŸæŠŠç”Ÿæˆç»“æœçª—å£ä¹Ÿæ¸…é™¤æ‰äº†

é‡åˆ°é—®é¢˜äº†ï¼Œå°±æ˜¯æˆ‘éœ€è¦å¤šçº¿ç¨‹å»å¤„ç†gradioå‰ç«¯ï¼Œç°åœ¨ç‚¹å‡»å¼€å§‹è·‘å›¾å°±ä¼šé˜»å¡æ—¥å¿—çš„å®æ—¶æ›´æ–°ï¼Œå®Œå…¨ä¸åŠ¨ï¼Œè·‘å®Œå›¾ç‰‡æ‰åŠ¨ï¼Œç”¨å¦ä¸€ä¸ªçº¿ç¨‹å»è½®è¯¢æ—¥å¿—ï¼Œé¿å…é˜»å¡ï¼Œè¯·ä¼˜åŒ–ä»£ç 

è¯·å¸®æˆ‘æ„å»ºä¸€ä¸ªæ ¸å¿ƒçš„åŠŸèƒ½


å°†gradioâ€”â€”workflow.pyæ£€ç´¢ç±»ä¼¼ ç¤ºä¾‹.jsonçš„å‡½æ•°æ–¹æ³•æ”¹æˆæ£€ç´¢"class_type":çš„æ–¹å¼ï¼Œåˆ©ç”¨ç±»åæ£€ç´¢ã€‚
æˆ‘çš„ç±»åè¯·å¯¹åº”init.pyä¸­çš„çœŸå®ç±»åï¼ŒNODE_CLASS_MAPPINGS å³è¾¹ä¸­å°±æ˜¯çœŸå®å¯¹åº”çš„ç±»åï¼Œè¿™äº›ç±»åæ˜¯å”¯ä¸€çš„ï¼Œ
æ ¹æ®NODE_DISPLAY_NAME_MAPPINGS = {å»æ‰¾åˆ°NODE_CLASS_MAPPINGSå³è¾¹çš„çœŸå®ç±»åè¿›è¡Œæ›¿æ¢åˆ°å‡½æ•°ä¸­æ­£ç¡®ç¼–å†™


æ‰‹åŠ¨æ›´æ”¹api jsonæµçš„ç±»åï¼Œå³è¾¹ä¸ºçœŸå®ç±»åï¼Œå·¦è¾¹ä¸ºæ˜¾ç¤ºåç§°ï¼Œ
"hua_gradioinput": GradioInputImage,
"hua_gradiooutput": Hua_Output,
"hua_gradio_video_output": Hua_Video_Output
